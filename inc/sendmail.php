<?php 

require 'mailgun-php/vendor/autoload.php';
use Mailgun\Mailgun;

function sendPasswordReset($aid,$token,$site) {
  global$con;

  $mg = new Mailgun(MAILGUN_KEY);
  $domain = MAILGUN_DOMAIN;
  
  $u = $con->fetch("SELECT * FROM cu_amb_usr WHERE aid = ?", $aid);

  $link = $site . '/reset/?token=' . $token;

  $html = "<p>We have received a request to reset your password for Morning Chalk Up Ambassadors. If you did not make this request feel free to ignore it. If you did make this request your reset will expire in 24 hours.</p>";

  $html .= '<p><a href="' . $link . '">Reset your password.</a></p>';

  $html = getTemplateTop() . $html . getTemplateBottom();

  $resetEmail = $mg->MessageBuilder();
  $resetEmail->setFromAddress('info@mail.morningchalkup.com', array('first' => 'Morning Chalk Up', 'last' => 'Ambassadors'));
  $resetEmail->addToRecipient($u['email'], array('first' => $u['fname'], 'last' => $u['lname']));
  $resetEmail->setSubject('Morning Chalk Up Ambassadors Passwrod Reset');
  $resetEmail->setHtmlBody($html);
  $resetEmail->setClickTracking(true);
  $mg->post("{$domain}/messages", $resetEmail->getMessage());
  
}

function getTemplateTop() {
  return "<html xmlns='http://www.w3.org/1999/xhtml' xmlns:v='urn:schemas-microsoft-com:vml' xmlns:o='urn:schemas-microsoft-com:office:office'><head> <!--[if gte mso 15]> <xml> <o:OfficeDocumentSettings> <o:AllowPNG/> <o:PixelsPerInch>96</o:PixelsPerInch> </o:OfficeDocumentSettings> </xml> <![endif]--><meta charset='UTF-8' /><meta http-equiv='X-UA-Compatible' content='IE=edge' /><meta name='viewport' content='width=device-width, initial-scale=1' /><title>{{ email_title }}</title><link rel='stylesheet' type='text/css' href='/assets/notifications/styles.css'><style type='text/css'>p{margin:10px 0;padding:0}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{display:block;margin:0;padding:0}img,a img{border:0;height:auto;outline:none;text-decoration:none}body,#bodyTable,#bodyCell{height:100%;margin:0;padding:0;width:100%}#outlook a{padding:0}img{-ms-interpolation-mode:bicubic}table{mso-table-lspace:0pt;mso-table-rspace:0pt}.ReadMsgBody{width:100%}.ExternalClass{width:100%}p,a,li,td,blockquote{mso-line-height-rule:exactly}a[href^=tel],a[href^=sms]{color:inherit;cursor:default;text-decoration:none}p,a,li,td,body,table,blockquote{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}.ExternalClass,.ExternalClass p,.ExternalClass td,.ExternalClass div,.ExternalClass span,.ExternalClass font{line-height:100%}a[x-apple-data-detectors]{color:inherit !important;text-decoration:none !important;font-size:inherit !important;font-family:inherit !important;font-weight:inherit !important;line-height:inherit !important}#bodyCell{padding:10px}.templateContainer{max-width:600px !important}a.mcnButton{display:block}.mcnImage{vertical-align:bottom}.mcnTextContent{word-break:break-word}.mcnTextContent img{height:auto !important}.mcnDividerBlock{table-layout:fixed !important}body,#bodyTable{background-color:#fff}#bodyCell{border-top:0}.templateContainer{border:0}h1{color:#333132;font-family:Helvetica;font-size:26px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:normal;text-align:left}h2{color:#333132;font-family:Helvetica;font-size:22px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:normal;text-align:left}h3{color:#333132;font-family:Helvetica;font-size:20px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:normal;text-align:left}h4{color:#333132;font-family:Helvetica;font-size:18px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:normal;text-align:left}#templatePreheader{background-color:#fff;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:0;padding-top:9px;padding-bottom:9px}#templatePreheader .mcnTextContent,#templatePreheader .mcnTextContent p{color:#656565;font-family:Helvetica;font-size:12px;line-height:150%;text-align:left}#templatePreheader .mcnTextContent a,#templatePreheader .mcnTextContent p a{color:#656565;font-weight:normal;text-decoration:underline}#templateHeader{background-color:#FFF;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:0;padding-top:9px;padding-bottom:0}#templateHeader .mcnTextContent,#templateHeader .mcnTextContent p{color:#202020;font-family:Helvetica;font-size:16px;line-height:150%;text-align:left}#templateHeader .mcnTextContent a,#templateHeader .mcnTextContent p a{color:#3d5ba9;font-weight:normal;text-decoration:underline}#templateBody{background-color:#fff;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:2px solid #EAEAEA;padding-top:0;padding-bottom:9px}#templateBody .mcnTextContent,#templateBody .mcnTextContent p{color:#333132;font-family:'Helvetica Neue',Helvetica,Arial,Verdana,sans-serif;font-size:16px;line-height:150%;text-align:left}#templateBody .mcnTextContent a,#templateBody .mcnTextContent p a{color:#3d5ba9;font-weight:normal;text-decoration:none}#templateFooter{background-color:#fff;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:0;padding-top:9px;padding-bottom:9px}#templateFooter .mcnTextContent,#templateFooter .mcnTextContent p{color:#656565;font-family:Helvetica;font-size:12px;line-height:150%;text-align:center}#templateFooter .mcnTextContent a,#templateFooter .mcnTextContent p a{color:#656565;font-weight:normal;text-decoration:underline}@media only screen and (min-width:768px){.templateContainer{width:600px !important}}@media only screen and (max-width: 480px){body,table,td,p,a,li,blockquote{-webkit-text-size-adjust:none !important}}@media only screen and (max-width: 480px){body{width:100% !important;min-width:100% !important}}@media only screen and (max-width: 480px){#bodyCell{padding-top:10px !important}}@media only screen and (max-width: 480px){.mcnImage{width:100% !important}}@media only screen and (max-width: 480px){.mcnCartContainer,.mcnCaptionTopContent,.mcnRecContentContainer,.mcnCaptionBottomContent,.mcnTextContentContainer,.mcnBoxedTextContentContainer,.mcnImageGroupContentContainer,.mcnCaptionLeftTextContentContainer,.mcnCaptionRightTextContentContainer,.mcnCaptionLeftImageContentContainer,.mcnCaptionRightImageContentContainer,.mcnImageCardLeftTextContentContainer,.mcnImageCardRightTextContentContainer{max-width:100% !important;width:100% !important}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer{min-width:100% !important}}@media only screen and (max-width: 480px){.mcnImageGroupContent{padding:9px !important}}@media only screen and (max-width: 480px){.mcnCaptionLeftContentOuter .mcnTextContent,.mcnCaptionRightContentOuter .mcnTextContent{padding-top:9px !important}}@media only screen and (max-width: 480px){.mcnImageCardTopImageContent,.mcnCaptionBlockInner .mcnCaptionTopContent:last-child .mcnTextContent{padding-top:18px !important}}@media only screen and (max-width: 480px){.mcnImageCardBottomImageContent{padding-bottom:9px !important}}@media only screen and (max-width: 480px){.mcnImageGroupBlockInner{padding-top:0 !important;padding-bottom:0 !important}}@media only screen and (max-width: 480px){.mcnImageGroupBlockOuter{padding-top:9px !important;padding-bottom:9px !important}}@media only screen and (max-width: 480px){.mcnTextContent,.mcnBoxedTextContentColumn{padding-right:18px !important;padding-left:18px !important}}@media only screen and (max-width: 480px){.mcnImageCardLeftImageContent,.mcnImageCardRightImageContent{padding-right:18px !important;padding-bottom:0 !important;padding-left:18px !important}}@media only screen and (max-width: 480px){.mcpreview-image-uploader{display:none !important;width:100% !important}}@media only screen and (max-width: 480px){h1{font-size:22px !important;line-height:125% !important}}@media only screen and (max-width: 480px){h2{font-size:20px !important;line-height:125% !important}}@media only screen and (max-width: 480px){h3{font-size:18px !important;line-height:125% !important}}@media only screen and (max-width: 480px){h4{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer .mcnTextContent,.mcnBoxedTextContentContainer .mcnTextContent p{font-size:14px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templatePreheader{display:block !important}}@media only screen and (max-width: 480px){#templatePreheader .mcnTextContent,#templatePreheader .mcnTextContent p{font-size:14px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateHeader .mcnTextContent,#templateHeader .mcnTextContent p{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateBody .mcnTextContent,#templateBody .mcnTextContent p{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateFooter .mcnTextContent,#templateFooter .mcnTextContent p{font-size:14px !important;line-height:150% !important}}.button__cell{background:{{shop.email_accent_color}}}a,a:hover,a:active,a:visited{color:{{shop.email_accent_color}}}.button__cell a{color:#fff}</style></head><body><center><table align='center' border='0' cellpadding='0' cellspacing='0' height='100%' width='100%' id='bodyTable'><tr><td align='center' valign='top' id='bodyCell'> <!--[if gte mso 9]><table align='center' border='0' cellspacing='0' cellpadding='0' width='600' style='width:600px;'><tr><td align='center' valign='top' width='600' style='width:600px;'> <![endif]--><table border='0' cellpadding='0' cellspacing='0' width='100%' class='templateContainer'><tr><td valign='top' id='templatePreheader'></td></tr><tr><td valign='top' id='templateHeader'><table border='0' cellpadding='0' cellspacing='0' width='100%' class='mcnImageBlock' style='min-width:100%;'><tbody class='mcnImageBlockOuter'><tr><td valign='top' style='padding:0px' class='mcnImageBlockInner'><table align='left' width='100%' border='0' cellpadding='0' cellspacing='0' class='mcnImageContentContainer' style='min-width:100%;'><tbody><tr><td class='mcnImageContent' valign='top' style='padding-right: 0px; padding-left: 0px; padding-top: 0; padding-bottom: 0; text-align:center;'><img align='center' alt='' src='https://gallery.mailchimp.com/2590f9a5c5961923b49f0256e/images/d80a5db1-452f-4d0f-b82c-2df86ad3438a.png' width='312.5' style='max-width:625px; padding-bottom: 0; display: inline !important; vertical-align: bottom;' class='mcnImage' /></td></tr></tbody></table></td></tr></tbody></table></td></tr><tr><td valign='top' id='templateBody'><table border='0' cellpadding='0' cellspacing='0' width='100%' class='mcnTextBlock' style='min-width:100%;'><tbody class='mcnTextBlockOuter'><tr><td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <!--[if mso]><table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'><tr> <![endif]--> <!--[if mso]><td valign='top' width='599' style='width:599px;'> <![endif]--><table align='left' border='0' cellpadding='0' cellspacing='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'><tbody><tr><td valign='top' class='mcnTextContent' style='padding: 0px 18px 9px; font-size: 16px; text-align: left;'>";
}

function getTemplateBottom() {
  return "</td></tr></table></center></td></tr></table></td></tr></tbody></table></td></tr></tbody></table><table border='0' cellpadding='0' cellspacing='0' width='100%' class='mcnDividerBlock' style='min-width:100%;'><tbody class='mcnDividerBlockOuter'><tr><td class='mcnDividerBlockInner' style='min-width:100%; padding:18px;'><table class='mcnDividerContent' border='0' cellpadding='0' cellspacing='0' width='100%' style='min-width:100%;'><tbody><tr><td></td></tr></tbody></table></td></tr></tbody></table><table border='0' cellpadding='0' cellspacing='0' width='100%' class='mcnTextBlock' style='min-width:100%;'><tbody class='mcnTextBlockOuter'><tr><td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <!--[if mso]><table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'><tr> <![endif]--> <!--[if mso]><td valign='top' width='599' style='width:599px;'> <![endif]--><table align='left' border='0' cellpadding='0' cellspacing='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'><tbody><tr><td valign='top' class='mcnTextContent' style='padding: 0px 18px 9px; font-size: 16px;'><div style='text-align: center;'> Want to get the Morning Chalk Up delivered to your inbox? <a href='https://morningchalkup.com/subscribe/?utm_source=email&utm_medium=store&utm_campaign=order-confirm'>Subscriber here</a>.</div></td></tr></tbody></table><!--[if mso]></td> <![endif]--> <!--[if mso]></tr></table> <![endif]--></td></tr></tbody></table><table border='0' cellpadding='0' cellspacing='0' width='100%' class='mcnDividerBlock' style='min-width:100%;'><tbody class='mcnDividerBlockOuter'><tr><td class='mcnDividerBlockInner' style='min-width: 100%; padding: 0px 18px;'><table class='mcnDividerContent' border='0' cellpadding='0' cellspacing='0' width='100%' style='min-width: 100%;border-top-width: 3px;border-top-style: solid;border-top-color: #333132;'><tbody><tr><td></td></tr></tbody></table></td></tr></tbody></table><table border='0' cellpadding='0' cellspacing='0' width='100%' class='mcnTextBlock' style='min-width:100%;'><tbody class='mcnTextBlockOuter'><tr><td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <!--[if mso]><table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'><tr> <![endif]--> <!--[if mso]><td valign='top' width='600' style='width:600px;'> <![endif]--><table align='left' border='0' cellpadding='0' cellspacing='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'><tbody><tr><td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'><div style='text-align: center;'> <img align='center' height='33' src='https://gallery.mailchimp.com/2590f9a5c5961923b49f0256e/images/cc8832a7-8b5c-4195-a40d-b6d10d2018c2.png' style='width: 350px; height: 33px; margin: 0px;' width='350' /><br /> <span style='font-size:12px'><a href='http://facebook.com/morningchalkup' target='_blank'>FACEBOOK</a> &nbsp;• &nbsp;<a href='http://instagram.com/morningchalkup' target='_blank'>INSTAGRAM</a> &nbsp;• &nbsp;<a href='https://www.youtube.com/channel/UCaVuIEkcQkaLKCUfWF2-Nqg' target='_blank'>YOUTUBE</a></span></div></td></tr></tbody></table><!--[if mso]></td> <![endif]--> <!--[if mso]></tr></table> <![endif]--></td></tr></tbody></table><table border='0' cellpadding='0' cellspacing='0' width='100%' class='mcnDividerBlock' style='min-width:100%;'><tbody class='mcnDividerBlockOuter'><tr><td class='mcnDividerBlockInner' style='min-width: 100%; padding: 0px 18px;'><table class='mcnDividerContent' border='0' cellpadding='0' cellspacing='0' width='100%' style='min-width: 100%;border-top: 3px solid #333132;'><tbody><tr><td></td></tr></tbody></table></td></tr></tbody></table><table border='0' cellpadding='0' cellspacing='0' width='100%' class='mcnBoxedTextBlock' style='min-width:100%;'> <!--[if gte mso 9]><table align='center' border='0' cellspacing='0' cellpadding='0' width='100%'> <![endif]--><tbody class='mcnBoxedTextBlockOuter'><tr><td valign='top' class='mcnBoxedTextBlockInner'> <!--[if gte mso 9]><td align='center' valign='top' '> <![endif]--><table align='left' border='0' cellpadding='0' cellspacing='0' width='100%' style='min-width:100%;' class='mcnBoxedTextContentContainer'><tbody><tr><td style='padding-top:9px; padding-left:18px; padding-bottom:9px; padding-right:18px;'><table border='0' cellpadding='18' cellspacing='0' class='mcnTextContentContainer' width='100%' style='min-width: 100% !important;background-color: #404040;'><tbody><tr><td valign='top' class='mcnTextContent' style='color: #F2F2F2;font-family: Helvetica;font-size: 14px;font-weight: normal;text-align: center;'><span style='font-size:12px'><em>Copyright © 2017 Morning Chalk Up, All rights reserved.</em></span></td></tr></tbody></table></td></tr></tbody></table><!--[if gte mso 9]></td> <![endif]--> <!--[if gte mso 9]></tr></table> <![endif]--></td></tr></tbody></table><table border='0' cellpadding='0' cellspacing='0' width='100%' class='mcnTextBlock' style='min-width:100%;'><tbody class='mcnTextBlockOuter'><tr><td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <!--[if mso]><table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'><tr> <![endif]--> <!--[if mso]><td valign='top' width='600' style='width:600px;'> <![endif]--><table align='left' border='0' cellpadding='0' cellspacing='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'><tbody><tr><td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'><div style='text-align: center;'> <span style='font-size:12px'><a href='http://morningchalkup.com/signup?utm_source=mailchimp&amp;utm_medium=email&amp;utm_campaign=signup-button' target='_blank'>SUBSCRIBE</a></span></div></td></tr></tbody></table><!--[if mso]></td> <![endif]--> <!--[if mso]></tr></table> <![endif]--></td></tr></tbody></table></td></tr><tr><td valign='top' id='templateFooter'></td></tr></table><!--[if gte mso 9]></td></tr></table> <![endif]--></td></tr></table></center></body></html>";
}